import numpy as np
import matplotlib.pyplot as plt
import pickle

# Read the data generated by `predict_180_days.py`
with open("future_predictions.pkl", "rb") as f:
data = pickle.load(f)

future_dates = data["future_dates"]
future_hybrid_predictions = data["future_hybrid_predictions"]

# Handle NaN values
print("üîç Check the number of NaN values:", np.isnan(future_hybrid_predictions).sum())
future_hybrid_predictions = np.nan_to_num(future_hybrid_predictions, nan=np.nanmedian(future_hybrid_predictions))
print("The number of NaN values ‚Äã‚Äãafter handling:", np.isnan(future_hybrid_predictions).sum())

# Recalculate the maximum and minimum growth points
max_idx = np.argmax(future_hybrid_predictions)
min_idx = np.argmin(future_hybrid_predictions)

# Output the highest and lowest growth points
print(f"Highest growth point: {future_dates[max_idx]}, Estimated number of subscriptions: {future_hybrid_predictions[max_idx][0]}")
print(f"Lowest growth point: {future_dates[min_idx]}, Estimated number of subscriptions: {future_hybrid_predictions[min_idx][0]}")

# Draw future growth trends
plt.figure(figsize=(12, 6))
plt.plot(future_dates, future_hybrid_predictions, label="Hybrid Prediction", linestyle="dashed", color="orange")
plt.scatter(future_dates[max_idx], future_hybrid_predictions[max_idx], color="red", label="Peak Growth", marker="o", s=100)
plt.scatter(future_dates[min_idx], future_hybrid_predictions[min_idx], color="blue", label="Lowest Growth", marker="o", s=100)

plt.xlabel("Date")
plt.ylabel("Subscribers")
plt.title("Future Growth Trend Analysis")
plt.legend()
plt.show()
